<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DFW Pool Evaporation & Conservation Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:#374151; background:#f0f9ff; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 16px; }

    /* Header: use white/blurred style from your reference */
    header { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); color:#1e3a8a; padding:12px 0; border-bottom:1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index: 10; }
    nav { display:flex; align-items:center; justify-content:space-between; }
    .logo { font-weight:700; color:#1e40af; text-decoration:none; display:flex; gap:.5rem; align-items:center; }
    .nav-links { list-style:none; display:flex; gap:18px; }
    .nav-links a { color:#64748b; text-decoration:none; font-weight:600; }
    .nav-links a:hover { color:#1e40af; }

    .hero { background:linear-gradient(135deg,#3b82f6,#1e40af); padding:32px 0; text-align:center; color:#fff; border-bottom:4px solid #1e3a8a; }
    .hero h1 { font-size: clamp(1.6rem, 3vw, 2.4rem); }
    .hero .subtitle { margin-top:6px; color:#e0f2fe; }

    .grid { display:grid; gap:16px; }
    @media (min-width: 900px){ .grid.two { grid-template-columns: 1fr 1fr; } }

    .card { background:#fff; border:2px solid #bfdbfe; border-radius:14px; padding:18px; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .card h3 { font-size:1.1rem; color:#1e3a8a; margin-bottom:10px; }
    .btn { width:100%; background:linear-gradient(45deg,#1e40af,#3b82f6); color:#fff; border:none; border-radius:10px; padding:14px 16px; font-weight:700; cursor:pointer; }

    /* Weather panel (pulled from your reference) */
    .weather-info { background:#fff; padding:16px; border-radius:14px; border:1px solid rgba(59,130,246,.25); box-shadow:0 10px 30px rgba(0,0,0,.06); display:none; }
    .weather-info h3 { color:#1e3a8a; }
    .weather-grid { display:grid; grid-template-columns: repeat(2,1fr); gap:12px; margin-top:10px; }
    @media (min-width: 640px){ .weather-grid { grid-template-columns: repeat(4,1fr);} }
    .weather-item { text-align:center; padding:12px; background:rgba(59,130,246,.06); border:1px solid rgba(59,130,246,.25); border-radius:12px; }
    .weather-item h5 { color:#1f2937; font-size:.9rem; margin-bottom:4px; }
    .weather-item p { color:#1e40af; font-weight:700; }

    .results { margin-top:16px; background:linear-gradient(135deg,#1e40af,#3b82f6); color:#fff; border-radius:14px; padding:18px; display:none; }
    .result-item { background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.25); border-radius:10px; padding:12px; margin-top:10px; }

    .callout { background: #dbeafe; border-left:6px solid #1e40af; padding:14px; border-radius:10px; }

    /* Section shells with colorful outlines */
    .conserve { background:#fff; border:2px solid #bfdbfe; border-radius:14px; padding:18px; margin-bottom:18px; }
    .conserve h3 { color:#1e3a8a; margin-bottom:10px; }
    .conserve ul { margin-left:1rem; }
    .conserve li { margin:.35rem 0; }

    /* Colored accents */
    .accent-teal { border-color:#5eead4; }
    .accent-teal h3 { color:#0f766e; }
    .accent-green { border-color:#86efac; }
    .accent-green h3 { color:#166534; }
    .accent-purple { border-color:#c4b5fd; }
    .accent-purple h3 { color:#5b21b6; }
    .accent-rose { border-color:#fecdd3; }
    .accent-rose h3 { color:#9f1239; }
    .accent-sky { border-color:#93c5fd; }
    .accent-sky h3 { color:#1d4ed8; }

    /* Bucket test stays yellow */
    #bucket-test { background:#fff; border:2px solid #facc15; border-radius:14px; padding:18px; }
    #bucket-test h3 { color:#ca8a04; }
    #bucket-test h4 { color:#b45309; margin-top:12px; }
    #bucket-test ol { margin-left:1rem; }
    #bucket-test li { margin:.5rem 0; }

    footer{ text-align:center; background:#1e40af; color:#e0f2fe; padding:24px 0; margin-top:24px; }
  </style>
</head>
<body>
  <!-- Header from your reference -->
  <header>
    <nav class="container">
      <a class="logo" href="https://dfwpoolpatrol.com">DFW Pool Patrol</a>
      <ul class="nav-links">
        <li><a href="#calculator">Calculator</a></li>
        <li><a href="#conserve">Conserve Water</a></li>
        <li><a href="#bucket-test">Bucket Test</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <div class="container">
      <h1>Pool Evaporation & Water Conservation (DFW)</h1>
      <p class="subtitle">Estimate water loss and cut it with proven, high‑impact mitigation techniques.</p>
    </div>
  </section>

  <main id="calculator" class="container" style="padding:16px 0 32px 0;">

    <!-- Weather block from your reference -->
    <div class="weather-info" id="weather-info">
      <h3>Current Weather Conditions</h3>
      <div class="weather-grid" id="weather-grid"></div>
    </div>

    <div class="grid two" style="margin-top:16px;">
      <div class="card">
        <h3>Pool Information</h3>
        <label style="display:block; font-weight:600; margin-top:10px;">Surface Area (sq ft)
          <input id="area" type="number" min="1" placeholder="e.g., 450" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
        </label>
        <label style="display:block; font-weight:600; margin-top:10px;">ZIP (DFW)
          <input id="zip-code" type="text" maxlength="5" placeholder="e.g., 75093" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
        </label>
      </div>

      <div class="card">
        <h3>Conditions</h3>
        <div class="grid two">
          <label style="font-weight:600;">Air Temp (°F)
            <input id="air-temp" type="number" min="32" max="120" placeholder="85" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
          </label>
          <label style="font-weight:600;">Water Temp (°F)
            <input id="water-temp" type="number" min="32" max="100" placeholder="80" value="80" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
          </label>
          <label style="font-weight:600;">Humidity (%)
            <input id="humidity" type="number" min="0" max="100" placeholder="50" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
          </label>
          <label style="font-weight:600;">Wind (mph)
            <input id="wind-speed" type="number" min="0" max="40" placeholder="7" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;"/>
          </label>
        </div>
        <label style="display:block; font-weight:600; margin-top:10px;">Cover Type
          <select id="pool-cover" style="width:100%; padding:10px; border:1px solid #93c5fd; border-radius:8px; margin-top:6px;">
            <option value="none">No Cover</option>
            <option value="solar">Solar Cover</option>
            <option value="safety">Safety Cover</option>
            <option value="automatic">Automatic Cover</option>
          </select>
        </label>
        <button class="btn" style="margin-top:12px;" onclick="calculateEvaporation()">Calculate</button>
      </div>
    </div>

    <section class="results" id="results">
      <h3>Evaporation Results</h3>
      <div class="result-item" id="res-daily"></div>
      <div class="result-item" id="res-proj"></div>
      <div class="result-item" id="res-tip"></div>
    </section>

    <section id="conserve" class="conserve accent-sky">
      <h3>Conserve Water: High‑Impact Pool Mitigations</h3>
      <div class="callout">
        <strong>Big wins:</strong> Use a cover when you’re not swimming (often 70–95% evaporation reduction). Add windbreaks, lower heat a few degrees, run water features only when you’re outside, and do a quick leak check monthly.
      </div>
      <ul>
        <li><strong>Cover consistency:</strong> A solar or automatic cover prevents most day‑to‑day evaporation.</li>
        <li><strong>Wind control:</strong> Wind strips moisture from the surface. Use fences, hedges, or screens to calm the waterline.</li>
        <li><strong>Temperature dial‑back:</strong> Drop setpoint a few °F when idle. Heat right before use, not 24/7.</li>
        <li><strong>Water features on a schedule:</strong> Run fountains/sheers for ambiance when you’re there, not overnight.</li>
        <li><strong>Monthly leak check:</strong> Do the bucket test below.</li>
        <li><strong>Smart filtration:</strong> Backwash only when pressure rises ~8–10 PSI.</li>
        <li><strong>Mind the waterline:</strong> Keep level just high enough for skimming.</li>
        <li><strong>Rain readiness:</strong> Let rainfall top‑off naturally where possible.</li>
      </ul>
    </section>

    <section id="bucket-test">
      <h3>Bucket Test (Leak Check)</h3>
      <p>Distinguish normal evaporation from a leak. Plan for a 24–48 hour window with no rain. Turn <em>off</em> autofill and water features.</p>
      <h4>Before You Start</h4>
      <ul>
        <li>Turn <strong>autofill OFF</strong>.</li>
        <li>Avoid high‑wind or rainy periods.</li>
        <li>Set features off during the test.</li>
      </ul>
      <h4>Step‑by‑Step</h4>
      <ol>
        <li>Fill a 5‑gal bucket with pool water and place on a step.</li>
        <li>Mark levels inside bucket and on pool tile.</li>
        <li>Run pump normal schedule. Wait 24h.</li>
        <li>Measure both drops, record values & weather.</li>
        <li>Repeat for 48h if needed.</li>
      </ol>
      <h4>Interpret Your Results</h4>
      <ul>
        <li><strong>≈ equal drops:</strong> Normal evaporation.</li>
        <li><strong>Pool drop greater:</strong> Leak likely.</li>
        <li><strong>Only when pump runs:</strong> Check pressure‑side plumbing.</li>
        <li><strong>Only when pump off:</strong> Suspect suction‑side or shell leak.</li>
      </ul>
    </section>

    <section class="conserve accent-teal">
      <h3>Evaporation Math Cheat Sheet</h3>
      <ul>
        <li><strong>Rule of thumb:</strong> 1 inch over 1 sq ft = 0.623 gal.</li>
        <li>15×30 ft pool ⇒ ~280 gal per inch.</li>
        <li>20×40 ft pool ⇒ ~498 gal per inch.</li>
        <li>Hot DFW summer: ~1/4–1/2″ per day typical.</li>
      </ul>
    </section>

    <section class="conserve accent-green">
      <h3>Cover Types & Expected Savings</h3>
      <ul>
        <li><strong>Automatic covers:</strong> ~90–95% reduction.</li>
        <li><strong>Solar covers:</strong> ~70–90% reduction.</li>
        <li><strong>Safety mesh:</strong> ~30–50% reduction.</li>
        <li><strong>Liquid covers:</strong> ~10–30% reduction.</li>
      </ul>
    </section>

    <section class="conserve accent-purple">
      <h3>DFW Seasonal Conservation Calendar</h3>
      <ul>
        <li><strong>Summer:</strong> Keep cover on, check for leaks weekly.</li>
        <li><strong>Spring/Fall:</strong> Re‑seal cover, service filters.</li>
        <li><strong>Winter:</strong> Covers still save water on windy days.</li>
      </ul>
    </section>

    <section class="conserve accent-rose">
      <h3>Myths & Facts</h3>
      <ul>
        <li><strong>“Only heat causes evaporation.”</strong> Wind & dry air matter too.</li>
        <li><strong>“Rain means no cover needed.”</strong> Not true; covers save between storms.</li>
        <li><strong>“Chlorine evaporates with water.”</strong> False; water leaves, chemicals concentrate.</li>
      </ul>
    </section>

    <section class="conserve">
      <h3>When to Call a Pro</h3>
      <ul>
        <li>Pool drops ≥1/4″ more than bucket in 24h.</li>
        <li>Autofill runs constantly; water bill spikes.</li>
        <li>Wet soil near equipment or constant trickle at waste line.</li>
      </ul>
    </section>

  </main>

  <footer>
    <div class="container">© 2025 Pool Calculator Tools</div>
  </footer>

  <script>
    // --- Helpers for vapor pressure and unit conversion ---
    function f2c(f){ return (f - 32) * 5/9; }
    function svpC(tc){ return 6.112 * Math.exp((17.67 * tc) / (tc + 243.5)); } // hPa; T in °C

    // Weather block from your reference (simulated)
    document.getElementById('zip-code').addEventListener('input', function(){
      const zip = this.value.trim();
      if(zip.length === 5){ fetchWeatherData(zip); }
    });

    async function fetchWeatherData(zipCode){
      try{
        const data = simulateDFWWeather();
        displayWeatherData(data);
        populateWeatherInputs(data);
      }catch(e){
        console.error('Weather fetch error', e);
        const fallback = { temperature:78, humidity:55, windSpeed:8, conditions:'Partly Cloudy' };
        populateWeatherInputs(fallback);
      }
    }

    function simulateDFWWeather(){
      const month = new Date().getMonth();
      let baseTemp, baseHumidity, baseWind;
      if(month>=5 && month<=8){ baseTemp = 85 + Math.random()*15; baseHumidity = 45 + Math.random()*25; baseWind = 5 + Math.random()*10; }
      else if((month>=2 && month<=4) || (month>=9 && month<=10)){ baseTemp = 65 + Math.random()*20; baseHumidity = 50 + Math.random()*30; baseWind = 8 + Math.random()*12; }
      else { baseTemp = 45 + Math.random()*20; baseHumidity = 60 + Math.random()*30; baseWind = 10 + Math.random()*15; }
      return { temperature: Math.round(baseTemp), humidity: Math.round(baseHumidity), windSpeed: Math.round(baseWind), conditions:'Partly Cloudy' };
    }

    function displayWeatherData(d){
      const wrap = document.getElementById('weather-info');
      const grid = document.getElementById('weather-grid');
      grid.innerHTML = `
        <div class="weather-item"><h5>Temperature</h5><p>${d.temperature}°F</p></div>
        <div class="weather-item"><h5>Humidity</h5><p>${d.humidity}%</p></div>
        <div class="weather-item"><h5>Wind Speed</h5><p>${d.windSpeed} mph</p></div>
        <div class="weather-item"><h5>Conditions</h5><p>${d.conditions}</p></div>
      `;
      wrap.style.display = 'block';
    }

    function populateWeatherInputs(d){
      document.getElementById('air-temp').value = d.temperature;
      document.getElementById('humidity').value = d.humidity;
      document.getElementById('wind-speed').value = d.windSpeed;
    }

    // --- Corrected evaporation calculator (ASHRAE/Carrier style) ---
    function calculateEvaporation(){
      const A = parseFloat(document.getElementById('area').value || '0');
      const TaF = parseFloat(document.getElementById('air-temp').value || '0');
      const TwF = (document.getElementById('water-temp').value || '') ? parseFloat(document.getElementById('water-temp').value) : TaF; // default Tw to air temp
      const rh = parseFloat(document.getElementById('humidity').value || '0');
      const wind = parseFloat(document.getElementById('wind-speed').value || '0');
      const cover = document.getElementById('pool-cover').value;
      if(!A || !TaF || (!rh && rh!==0)) { alert('Enter surface area, air temp, and humidity.'); return; }

      // Vapor pressures (converted to inHg for correlation)
      const TaC = f2c(TaF);
      const TwC = f2c(TwF);
      const es_w = svpC(TwC);             // hPa at water temp
      const es_a = svpC(TaC);             // hPa at air temp
      const ea   = es_a * (rh/100);       // hPa actual
      const Pw = es_w / 33.8639;          // inHg
      const Pa = ea   / 33.8639;          // inHg
      const dP = Math.max(Pw - Pa, 0);    // driving force

      // m_dot [lb/h] = A[ft²] * dP[inHg] * (0.089 + 0.0782*V[mph])
      let m_lb_per_h = A * dP * (0.089 + 0.0782 * wind);

      // Cover residual (fraction that still evaporates)
      let residual = 1; // none
      if(cover === 'solar') residual = 0.3;        // ~70% reduction
      else if(cover === 'safety') residual = 0.7;  // ~30–50% reduction
      else if(cover === 'automatic') residual = 0.1;// ~90% reduction
      m_lb_per_h *= residual;

      // Convert mass rate to volume and depth
      const gal_day = (m_lb_per_h * 24) / 8.34;                 // 8.34 lb/gal
      const inches_day = (gal_day * 12) / (A * 7.48);           // inches/day

      const weekly  = gal_day * 7;
      const monthly = gal_day * 30;

      document.getElementById('results').style.display = 'block';
      document.getElementById('res-daily').innerHTML = `<strong>Daily:</strong> ${gal_day.toFixed(0)} gal (~${inches_day.toFixed(2)}\")`;
      document.getElementById('res-proj').innerHTML  = `<strong>Weekly:</strong> ${weekly.toFixed(0)} gal • <strong>Monthly:</strong> ${monthly.toFixed(0)} gal`;
      const loads = Math.max(1, Math.round(weekly / 20)); // ≈20 gal per laundry load
      const tip = cover==='none' ? 'Add a cover when not swimming to cut most of this loss.' : 'Nice—your cover already cuts a large share of evaporation.';
      document.getElementById('res-tip').innerHTML = `≈ ${loads} laundry loads/week saved with a cover. ${tip}`;
    }

    // Initialize with a default ZIP code like your reference
    setTimeout(()=>{ const z=document.getElementById('zip-code'); if(z){ z.value='75201'; fetchWeatherData('75201'); } }, 800);
  </script>
</body>
</html>
